<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>VerificaciÃ³n de QR</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>VerificaciÃ³n de QR</h1>
  <p id="status">Cargando...</p>

  <script>
    const supabaseUrl = "https://vyagabfmbyjcbslfdgua.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ5YWdhYmZtYnlqY2JzbGZkZ3VhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwODk1NzIsImV4cCI6MjA2OTY2NTU3Mn0.oxIjeQSVR78X3Oi1jPg9sXYJI-YAlnMWm01VdxRHW0w";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    // Obtener el ID desde la URL
    const params = new URLSearchParams(window.location.search);
    const qrId = params.get("id");

    async function verifyQR() {
      const status = document.getElementById("status");

      // ðŸ”¹ Mostrar todos los QR disponibles en consola para debug
      const allData = await supabaseClient.from("certificaciones").select("*");
      console.log("Todos los registros en certificaciones:", allData.data);

      // ðŸ”¹ Buscar el QR especÃ­fico
      const { data, error } = await supabaseClient
        .from("certificaciones")
        .select("*")
        .eq("fortune_qr", qrId)
        .single();

      if (error) {
        console.error("Error en la consulta:", error);
        status.innerText = "Error al verificar el QR.";
      } else if (data) {
        status.innerText = `âœ… QR vÃ¡lido. Datos: ${JSON.stringify(data)}`;
      } else {
        status.innerText = "QR no vÃ¡lido.";
      }
    }

    verifyQR();
  </script>
</body>
</html>
